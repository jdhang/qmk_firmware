// Copyright 2022 Diego Palacios (@diepala)
// SPDX-License-Identifier: GPL-2.0

#include QMK_KEYBOARD_H

/* Layer defines (for readability) */
#define _BASE 0
#define _SYM 1
#define _NAV 2
#define _NUM 3
#define _COLE 4

enum custom_keycodes {
  /* Mod defines */
  M_ARROW_REQL, /* => */

  /* Tap dance defines */
  TD_CTL_GUI = 0,
  TD_EQL_REQL = 0,
  TD_GUI_CTL = 0,
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
     /*
      * ┌───┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬───┐
      * │Tab│ Q │ W │ E │ R │ T │       │ Y │ U │ I │ O │ P │ - │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │ESC│ A │ S │ D │ F │ G │       │ H │ J │ K │ L │ ; │ ' │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │Sft│ Z │ X │ C │ V │ B │       │ N │ M │ , │ . │ / │   │
      * └───┴───┴───┴───┴───┴───┘       └───┴───┴───┴───┴───┴───┘
      *               ┌───┐                   ┌───┐
      *               │GUI├───┐           ┌───┤ARe│
      *               └───┤Bsp├───┐   ┌───┤Num├───┘
      *                   └───┤   │   │Ent├───┘
      *                       └───┘   └───┘
      */
    [_BASE] = LAYOUT_split_3x6_3(
      //-------------------------------------------------------------------------------      ----------------------------------------------------------------------------------
        KC_TAB,  KC_Q, KC_W, KC_E,          KC_R,           KC_T,                                                       KC_Y,     KC_U,    KC_I,    KC_O,    KC_P,    KC_MINS,
      //-------------------------------------------------------------------------------      ---------------------------------------------------------------------------------
        KC_ESC,  KC_A, KC_S, KC_D,          KC_F,           KC_G,                                                       KC_H,     KC_J,    KC_K,    KC_L,    KC_SCLN, KC_QUOT,
      //-------------------------------------------------------------------------------      ---------------------------------------------------------------------------------
        KC_LSFT, KC_Z, KC_X, KC_C, KC_V, KC_B,                                                       KC_N,     KC_M,    KC_COMM, KC_DOT,  KC_SLSH, KC_NO,
      //-------------------------------------------------------------------------------      ---------------------------------------------------------------------------------
                                            TD(TD_GUI_CTL), LT(_NUM, KC_BSPC), LT(_SYM, KC_SPC),      LT(_NAV, KC_ENT), QK_AREP,  KC_NO
      //-------------------------------------------------------------------------------      ---------------------------------------------------------------------------------
    ),
     /*
      * ┌───┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬───┐
      * │   │ ` │ - │ + │ @ │ . │       │ & │ * │ [ │ ] │ - │   │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │   │ ! │ ? │ ^ │ = │ # │       │ | │ ( │ ) │ % │ ' │   │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │   │   │   │   │   │   │       │ ` │ $ │ { │ } │ \ │   │
      * └───┴───┴───┴───┴───┴───┘       └───┴───┴───┴───┴───┴───┘
      *               ┌───┐                   ┌───┐
      *               │   ├───┐           ┌───┤   │
      *               └───┤   ├───┐   ┌───┤ARe├───┘
      *                   └───┤   │   │Rep├───┘
      *                       └───┘   └───┘
      */
    [_SYM] = LAYOUT_split_3x6_3(
      //-------------------------------------------------------------------        ---------------------------------------------------------------------------------
        KC_NO, KC_GRV,  KC_MINS, KC_PLUS, KC_AT,           KC_DOT,                         KC_AMPR, KC_ASTR, KC_LBRC, KC_RBRC, KC_MINS,  KC_NO,
      //-------------------------------------------------------------------        ---------------------------------------------------------------------------------
        KC_NO, KC_EXLM, KC_QUES, KC_CIRC, TD(TD_EQL_REQL), KC_HASH,                        KC_PIPE, KC_LPRN, KC_RPRN, KC_PERC, KC_QUOT,  KC_NO,
      //-------------------------------------------------------------------        ---------------------------------------------------------------------------------
        KC_NO, KC_NO,   KC_NO,   KC_NO,   KC_NO,           KC_NO,                          KC_GRV,  KC_DLR,  KC_LCBR, KC_RCBR, KC_BSLS,  KC_NO,
      //--------------------------------------------------------------------       ---------------------------------------------------------------------------------
                                          KC_NO,           KC_NO, KC_NO,           QK_REP, QK_AREP, KC_NO
      //-------------------------------------------------------------------        ---------------------------------------------------------------------------------
    ),
     /*
      * ┌───┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬───┐
      * │   │Tab│   │CHm│CEd│   │       │G[ │CST│CT │G] │   │   │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │   │Esc│   │Hom│End│   │       │ L │ D │ U │ R │   │TO1│
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │   │   │ L │ D │ U │ R │       │LAT│PDn│PUp│   │   │TO4│
      * └───┴───┴───┴───┴───┴───┘       └───┴───┴───┴───┴───┴───┘
      *               ┌───┐                   ┌───┐
      *               │Rep├───┐           ┌───┤   │
      *               └───┤Del├───┐   ┌───┤   ├───┘
      *                   └───┤Ctl│   │   ├───┘
      *                       └───┘   └───┘
      */
    [_NAV] = LAYOUT_split_3x6_3(
      //------------------------------------------------------------------------         ---------------------------------------------------------------------------------
        KC_NO, KC_TAB, KC_NO,   C(KC_HOME), C(KC_END), KC_NO,                                     G(KC_LBRC), C(S(KC_TAB)), C(KC_TAB), G(KC_RBRC), KC_NO,  KC_NO,
      //------------------------------------------------------------------------         ---------------------------------------------------------------------------------
        KC_NO, KC_ESC, KC_NO,   KC_HOME,    KC_END,    KC_NO,                                     KC_LEFT,    KC_DOWN,      KC_UP,     KC_RIGHT,   KC_NO,  TO(_BASE),
      //------------------------------------------------------------------------         ---------------------------------------------------------------------------------
        KC_NO, KC_NO,  KC_LEFT, KC_DOWN,    KC_UP,     KC_RIGHT,                                  G(KC_LALT), KC_PGDN,      KC_PGUP,   KC_NO,      KC_NO,  TO(_COLE),
      //------------------------------------------------------------------------         ---------------------------------------------------------------------------------
                                            QK_REP,    KC_DEL,   TD(TD_CTL_GUI),           KC_NO, KC_NO,      KC_NO
      //------------------------------------------------------------------------         ---------------------------------------------------------------------------------
    ),
     /*
      * ┌───┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬───┐
      * │   │   │   │   │   │ % │       │ * │ 7 │ 8 │ 9 │ + │   │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │   │   │   │   │Sft│ , │       │ . │ 4 │ 5 │ 6 │ - │   │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │   │TO3│   │   │   │   │       │ 0 │ 1 │ 2 │ 3 │ / │   │
      * └───┴───┴───┴───┴───┴───┘       └───┴───┴───┴───┴───┴───┘
      *               ┌───┐                   ┌───┐
      *               │   ├───┐           ┌───┤ 0 │
      *               └───┤   ├───┐   ┌───┤   ├───┘
      *                   └───┤   │   │Ent├───┘
      *                       └───┘   └───┘
      */
    [_NUM] = LAYOUT_split_3x6_3(
      //-------------------------------------------------------------------         ---------------------------------------------------------------------------------
        KC_NO, KC_NO,     KC_NO, KC_NO, KC_NO,   KC_PERC,                                   KC_ASTR, KC_7,   KC_8,  KC_9,  KC_PLUS,  KC_NO,
      //-------------------------------------------------------------------         ---------------------------------------------------------------------------------
        KC_NO, KC_NO,     KC_NO, KC_NO, KC_LSFT, KC_COMM,                                   KC_DOT,  KC_4,   KC_5,  KC_6,  KC_MINS,  KC_NO,
      //-------------------------------------------------------------------         ---------------------------------------------------------------------------------
        KC_NO, TO(_BASE), KC_NO, KC_NO, KC_NO,   KC_NO,                                     KC_0,    KC_1,   KC_2,  KC_3,  KC_SLSH,  KC_NO,
      //-------------------------------------------------------------------         ---------------------------------------------------------------------------------
                                        KC_NO,   KC_TRNS, KC_NO,                    KC_ENT, KC_NO,   KC_0
      //-------------------------------------------------------------------         ---------------------------------------------------------------------------------
    ),
     /*
      * ┌───┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬───┐
      * │Tab│ Q │ W │ E │ R │ T │       │ Y │ U │ I │ O │ P │ - │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │ESC│ A │ S │ D │ F │ G │       │ H │ J │ K │ L │ ; │ ' │
      * ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
      * │Sft│ Z │ X │ C │ V │ B │       │ N │ M │ , │ . │ / │   │
      * └───┴───┴───┴───┴───┴───┘       └───┴───┴───┴───┴───┴───┘
      *               ┌───┐                   ┌───┐
      *               │GUI├───┐           ┌───┤   │
      *               └───┤Bsp├───┐   ┌───┤   ├───┘
      *                   └───┤   │   │Ent├───┘
      *                       └───┘   └───┘
      */
    [_COLE] = LAYOUT_split_3x6_3(
      //-------------------------------------------------------------------------------      ----------------------------------------------------------------------------------
        KC_TAB,  KC_Q, KC_W, KC_F, KC_P,           KC_B,                                                       KC_J,     KC_L,    KC_U,    KC_Y,    KC_SCLN, KC_MINS,
      //-------------------------------------------------------------------------------      ---------------------------------------------------------------------------------
        KC_ESC,  KC_A, KC_R, KC_S, KC_T,           KC_G,                                                       KC_M,     KC_N,    KC_E,    KC_I,    KC_O,    KC_QUOT,
      //-------------------------------------------------------------------------------      ---------------------------------------------------------------------------------
        KC_LSFT, KC_Z, KC_X, KC_C, KC_D,  KC_V,                                                       KC_K,     KC_H,    KC_COMM, KC_DOT,  KC_SLSH, KC_NO,
      //-------------------------------------------------------------------------------      ---------------------------------------------------------------------------------
                                   TD(TD_GUI_CTL), LT(_NUM, KC_BSPC), LT(_SYM, KC_SPC),      LT(_NAV, KC_ENT), MO(_NUM), KC_NO
      //-------------------------------------------------------------------------------      ---------------------------------------------------------------------------------
    )
};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  switch(keycode) {
      case M_ARROW_REQL:  /* => */
        if (record->event.pressed) {
          SEND_STRING("=>");
          return false;
        }
        break;
  }

  return true;
}

/* Tap dance function definitions */
void dance_eql_arrow(tap_dance_state_t *state, void *user_data) {
    switch (state->count) {
      case 1:
        SEND_STRING("=");
        break;
      case 2:
        SEND_STRING("=>");
        break;
    }
}

// Tap dance definitions
tap_dance_action_t tap_dance_actions[] = {
    [TD_CTL_GUI] = ACTION_TAP_DANCE_DOUBLE(KC_LCTL, KC_LGUI),
    // tap: =, double-tap: =>
    [TD_EQL_REQL] = ACTION_TAP_DANCE_FN(dance_eql_arrow),
    [TD_GUI_CTL] = ACTION_TAP_DANCE_DOUBLE(KC_LGUI, KC_LCTL),
};
